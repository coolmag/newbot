# Changelog

## Версия 3.2 - Улучшения и исправления

### Критические исправления
- ✅ Исправлена ошибка с `app.updater.idle()` - заменено на `asyncio.Event().wait()`
- ✅ Исправлены синтаксические ошибки в f-строках (handlers.py, radio.py)
- ✅ Исправлена работа меню - кнопка "Сменить источник" теперь правильно показывает клавиатуру

### Улучшения источников
- ✅ Убран Deezer из источников (только 30 секунд превью)
- ✅ Улучшен YouTube загрузчик для обхода блокировки:
  - Добавлен User-Agent
  - Добавлен referer
  - Использованы extractor_args с разными клиентами (android, web)
  - Улучшена обработка ошибок с понятными сообщениями
- ✅ Добавлена поддержка cookies файла для YouTube
- ✅ Улучшена обработка результатов поиска YouTube

### Новые функции
- ✅ Добавлено автоматическое приветствие при добавлении бота в канал/группу
- ✅ Улучшено логирование всех команд и действий
- ✅ Добавлена обработка неизвестных команд

### Документация
- ✅ Обновлен README с инструкциями по использованию cookies
- ✅ Добавлена информация о необходимости cookies для YouTube
- ✅ Обновлена документация для Railway

## Версия 3.1 - Упрощение структуры проекта

### Изменения структуры
- ✅ Все файлы перемещены из папки `src/` в корень проекта
- ✅ Упрощена структура проекта для более легкой загрузки на GitHub
- ✅ Обновлены все импорты (убраны префиксы `src.`)
- ✅ Обновлен Dockerfile для работы с новой структурой
- ✅ Обновлен railway.json для новой структуры
- ✅ Обновлен README.md с новой структурой проекта

### Технические изменения
- ✅ Исправлен BASE_DIR в config.py (теперь указывает на корень проекта)
- ✅ Все модули теперь находятся в корне для упрощения импортов

## Версия 3.0 - Полная проверка и оптимизация

### Исправления багов
- ✅ Исправлена опечатка в приветственном сообщении ("названмем" → "названием")
- ✅ Удален неиспользуемый импорт `re` из `youtube.py`
- ✅ Удален дублирующийся файл `src/ __init__.py` (с пробелом)
- ✅ Исправлена обработка callback `source_switch` → `source_select`
- ✅ Исправлен отступ в `youtube.py` (строка 125)
- ✅ Улучшена проверка существования файлов в кэше
- ✅ Добавлена фильтрация None значений в результатах YouTube поиска

### Улучшения кода
- ✅ Добавлен graceful shutdown с закрытием всех ресурсов
- ✅ Добавлена проверка размера файла перед отправкой в Telegram (лимит 50MB)
- ✅ Улучшена обработка ошибок в `_send_audio`
- ✅ Добавлена проверка на None для callback_query
- ✅ Улучшена проверка FFmpeg (более надежная, с таймаутом)
- ✅ Добавлено закрытие HTTP сессий DeezerDownloader при завершении работы

### Новые файлы
- ✅ Создан `.env.example` с примерами конфигурации
- ✅ Создан `railway.json` для развертывания на Railway
- ✅ Создан `CHANGELOG.md` для отслеживания изменений

### Обновления документации
- ✅ Обновлен README.md с инструкциями для Railway
- ✅ Добавлен раздел "Развертывание на Railway"
- ✅ Исправлена опечатка в разделе команд
- ✅ Добавлены подробные инструкции по настройке

### Оптимизации
- ✅ Улучшена обработка edge cases во всех модулях
- ✅ Добавлена валидация данных перед обработкой
- ✅ Оптимизирована работа с кэшем (проверка существования файлов)

### Готовность к production
- ✅ Все файлы проверены на синтаксические ошибки
- ✅ Код готов для загрузки на GitHub
- ✅ Конфигурация готова для развертывания на Railway
- ✅ Dockerfile и docker-compose.yml проверены и оптимизированы

